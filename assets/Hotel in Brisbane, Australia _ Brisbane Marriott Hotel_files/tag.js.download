!function(){"use strict";function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var TagLogger=function(){function TagLogger(config){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,TagLogger),this.config=config}var Constructor,protoProps,staticProps;return Constructor=TagLogger,(protoProps=[{key:"info",value:function(_info){this._log("info",_info)}},{key:"error",value:function(info){this._log("error",info)}},{key:"_log",value:function(level,info){var name=info.name,message=info.message,details=info.details,logString="Container Tag ".concat(this.config.metadata.hash,":")+"".concat(level?" "+level.toLowerCase():" info",".")+"".concat(name?" name: ".concat(name,";"):"")+"".concat(message?" message: ".concat(message,";"):"")+"".concat(details?" details: ".concat(details,";"):"");console.log(logString)}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),TagLogger}();function CookieDropper_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var CookieDropper=function(){function CookieDropper(pixelReporter){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,CookieDropper),this.pixelReporter=pixelReporter}var Constructor,protoProps,staticProps;return Constructor=CookieDropper,(protoProps=[{key:"dropCookie",value:function(){this.pixelReporter.report("https://rtr.innovid.com/placement/container-tag/uuid/[cb]")}}])&&CookieDropper_defineProperties(Constructor.prototype,protoProps),staticProps&&CookieDropper_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),CookieDropper}();function TagMonitor_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function TagMonitor_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var TagMonitor=function(){function TagMonitor(config,pixelReporter){var alwaysOn=arguments.length>2&&void 0!==arguments[2]&&arguments[2];TagMonitor_classCallCheck(this,TagMonitor),this.config=config,this.pixelReporter=pixelReporter,this.alwaysOn=alwaysOn}var Constructor,protoProps,staticProps;return Constructor=TagMonitor,protoProps=[{key:"error",value:function(){var info=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{name:"",cause:"",message:""},shouldFireErrorPixel=0===Math.floor(200*Math.random());(shouldFireErrorPixel||this.alwaysOn)&&this.track(TagMonitor.ActionType.Error,info)}},{key:"track",value:function(action){var info=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{name:"",cause:"",message:""},queryParams="?action=".concat(action)+"&hash=".concat(this.config.metadata.hash)+"&advertiserId=".concat(this.config.metadata.advertiserId)+"&errorName=".concat(encodeURIComponent(info.name||""))+"&errorCause=".concat(encodeURIComponent(info.cause||""))+"&errorMessage=".concat(encodeURIComponent(info.message||""))+"&url=".concat(encodeURIComponent(window.location.href));this.pixelReporter.report("https://d2v83son8kay5v.cloudfront.net/1x1.gif"+queryParams)}}],staticProps=[{key:"ActionType",get:function(){return{Initialize:"ct-init",Error:"ct-error",ProbIdSuccess:"ct-probid-success",ProbIdFailure:"ct-probid-failure"}}}],protoProps&&TagMonitor_defineProperties(Constructor.prototype,protoProps),staticProps&&TagMonitor_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),TagMonitor}();function PixelReporter_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var PixelReporter=function(){function PixelReporter(){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,PixelReporter)}var Constructor,protoProps,staticProps;return Constructor=PixelReporter,protoProps=[{key:"report",value:function(src){var onError=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},imgPixel=document.createElement("img");imgPixel.onerror=function(){return onError(src)},imgPixel.src=src.replace(PixelReporter.CacheBusterMacro,Date.now().toString()),imgPixel.style.display="none",imgPixel.setAttribute("alt",""),document.body.appendChild(imgPixel)}},{key:"reportWithCacheBuster",value:function(src){var onError=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};src.indexOf("?")>=0?src+="&":src+="?",src+="cb=".concat(PixelReporter.CacheBusterMacro),this.report(src,onError)}}],staticProps=[{key:"CacheBusterMacro",get:function(){return"[cb]"}}],protoProps&&PixelReporter_defineProperties(Constructor.prototype,protoProps),staticProps&&PixelReporter_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),PixelReporter}();function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}function RetargetingReporter_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var RetargetingReporter=function(){function RetargetingReporter(pixelReporter){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,RetargetingReporter),this.pixelReporter=pixelReporter}var Constructor,protoProps,staticProps;return Constructor=RetargetingReporter,(protoProps=[{key:"retarget",value:function(ownerId,eventId,params,onError){var qs="object"===_typeof(params)?"&".concat(Object.keys(params).map((function(key){return"".concat(encodeURI(key),"=").concat(encodeURI(params[key].toString()))})).join("&")):"",url="https://ag.innovid.com/retargeting/pixel"+"?ownerId=".concat(ownerId,"&eventId=").concat(encodeURIComponent(eventId)).concat(qs);this.pixelReporter.reportWithCacheBuster(url,onError)}}])&&RetargetingReporter_defineProperties(Constructor.prototype,protoProps),staticProps&&RetargetingReporter_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),RetargetingReporter}();function EventNotifier_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var EventNotifier=function(){function EventNotifier(){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,EventNotifier),this.events={}}var Constructor,protoProps,staticProps;return Constructor=EventNotifier,protoProps=[{key:"subscribe",value:function(eventType,callbackFunction){this.events[eventType]||(this.events[eventType]=[]),this.events[eventType].push(callbackFunction)}},{key:"notify",value:function(eventType){var domEvent=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this.events[eventType]){var callbackFunctions=this.events[eventType];callbackFunctions.forEach((function(func){return func(domEvent)}))}}}],protoProps&&EventNotifier_defineProperties(Constructor.prototype,protoProps),staticProps&&EventNotifier_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),EventNotifier}(),hasBeenInitialized=!1;function handlePageLoadEvent(notifier){notifier.notify(InnovidEventType.PAGE_LOAD)}var UrlChangeEventInitializer_hasBeenInitialized=!1,lastUrl="";function initializeUrlChangeEventListener(notifier){!function(notifier){(function(notifier){"complete"===document.readyState?setTimeout(notifier.notify(InnovidEventType.URL_CHANGE),0):window.addEventListener(WindowEvent.LOAD,(function(){return handleUrlChangeEvent(notifier)}))})(notifier),function(notifier){[WindowEvent.POP_STATE,WindowEvent.HASH_CHANGE].forEach((function(eventType){window.addEventListener(eventType,(function(){return handleUrlChangeEvent(notifier)}))}))}(notifier)}(notifier),function(notifier){[WindowFunction.PUSH_STATE,WindowFunction.REPLACE_STATE].forEach((function(fnName){addNotificationToWindowHistoryMethods(fnName,notifier)}))}(notifier)}function handleUrlChangeEvent(notifier){var currentUrl;currentUrl=window.location.href,lastUrl!==currentUrl&&(lastUrl=currentUrl,1)&&notifier.notify(InnovidEventType.URL_CHANGE)}var addNotificationToWindowHistoryMethods=function(fnName,notifier){var originalFn=window.history[fnName];window.history[fnName]=function(){for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];originalFn.apply(this,args),handleUrlChangeEvent(notifier)}};var _InnovidEventTypesIni,ClickEventInitializer_hasBeenInitialized=!1;function initializeClickEventListener(notifier){window.addEventListener("click",(function(event){!function(notifier,event){setTimeout((function(){return notifier.notify(InnovidEventType.CLICK,event)}),0)}(notifier,event)}),!0)}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}var InnovidEventType={PAGE_LOAD:"load",URL_CHANGE:"urlchange",CLICK:"click"},InnovidEventTypesInitializers=(_defineProperty(_InnovidEventTypesIni={},InnovidEventType.PAGE_LOAD,(function(notifier){hasBeenInitialized||(!function(notifier){"complete"===document.readyState?setTimeout((function(){return handlePageLoadEvent(notifier)}),0):window.addEventListener(WindowEvent.LOAD,(function(){return handlePageLoadEvent(notifier)}))}(notifier),hasBeenInitialized=!0)})),_defineProperty(_InnovidEventTypesIni,InnovidEventType.URL_CHANGE,(function(notifier){UrlChangeEventInitializer_hasBeenInitialized||(initializeUrlChangeEventListener(notifier),UrlChangeEventInitializer_hasBeenInitialized=!0)})),_defineProperty(_InnovidEventTypesIni,InnovidEventType.CLICK,(function(notifier){ClickEventInitializer_hasBeenInitialized||(initializeClickEventListener(notifier),ClickEventInitializer_hasBeenInitialized=!0)})),_InnovidEventTypesIni),WindowEvent={LOAD:"load",HASH_CHANGE:"hashchange",POP_STATE:"popstate",CLICK:"click"},WindowFunction={PUSH_STATE:"pushState",REPLACE_STATE:"replaceState"};function DOMEventSubscriber_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var DOMEventSubscriber=function(){function DOMEventSubscriber(){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,DOMEventSubscriber),this.notifier=new EventNotifier}var Constructor,protoProps,staticProps;return Constructor=DOMEventSubscriber,(protoProps=[{key:"subscribeHandler",value:function(eventType,handler){InnovidEventTypesInitializers[eventType](this.notifier),this.notifier.subscribe(eventType,handler)}}])&&DOMEventSubscriber_defineProperties(Constructor.prototype,protoProps),staticProps&&DOMEventSubscriber_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),DOMEventSubscriber}();function CustomActionDecorator_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var CustomActionDecorator=function(){function CustomActionDecorator(reporter,monitor){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,CustomActionDecorator),this.reporter=reporter,this.monitor=monitor}var Constructor,protoProps,staticProps;return Constructor=CustomActionDecorator,(protoProps=[{key:"decorate",value:function(target,config){var _this=this;target.INVTAG={version:function(){return console.log("INV:","v371")},track:function(eventId,params){_this.reporter.retarget(config.metadata.advertiserId,eventId,params,(function(src){_this.monitor.error({message:"Failed to fire retargeting pixel",cause:src})}))}}}}])&&CustomActionDecorator_defineProperties(Constructor.prototype,protoProps),staticProps&&CustomActionDecorator_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),CustomActionDecorator}();function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach((function(key){TagInspector_defineProperty(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}function TagInspector_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function TagInspector_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var TagInspector=function(){function TagInspector(config){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,TagInspector),this.config=config,this.bufferQueue=[],this.targetWin=null}var Constructor,protoProps,staticProps;return Constructor=TagInspector,staticProps=[{key:"SessionKey",get:function(){return"inv_session"}},{key:"TagType",get:function(){return{ContainerTag:"container-tag",RetargetingTag:"retargeting-tag",ConversionTag:"conversion-tag",MonitorTag:"monitor-tag"}}}],(protoProps=[{key:"start",value:function(){var _this=this;if(this.isEnabled()){console.log("INV inspector>> supported!");var session=this._extractSession();session&&(console.log("INV inspector>> session:",session),window.sessionStorage.setItem(TagInspector.SessionKey,session),this._startDebugging(),this._createMessageBridge((function(){_this._sendByTypeAndParams(TagInspector.TagType.ContainerTag,{ownerId:_this.config.metadata.advertiserId,hash:_this.config.metadata.hash}),_this._sendAndClearBufferedMessages()})))}}},{key:"_sendAndClearBufferedMessages",value:function(){var _this2=this;this.bufferQueue.length>0&&console.log("INV inspector>> buffered messages:",this.bufferQueue.length),this.bufferQueue.forEach((function(msg){return _this2._sendMessage(msg)})),this.bufferQueue=[]}},{key:"isEnabled",value:function(){return!!window.PerformanceObserver&&!!this._extractSession()}},{key:"_extractSession",value:function(){return location.search.indexOf(TagInspector.SessionKey)>=0?new URLSearchParams(location.search).get(TagInspector.SessionKey):window.sessionStorage.getItem(TagInspector.SessionKey)}},{key:"_startDebugging",value:function(){var _this3=this,handlers=[{matcher:new RegExp("https://ag.innovid.com/retargeting/pixel"),handler:function(params){return _this3._sendByTypeAndParams(TagInspector.TagType.RetargetingTag,params)}},{matcher:new RegExp("https://s-a.innovid.com/conversion"),handler:function(params,url){return _this3._sendByTypeAndParams(TagInspector.TagType.ConversionTag,_objectSpread(_objectSpread({},params),{},{hash:_this3._extractConversionHash(url)}))}},{matcher:new RegExp("https://d2v83son8kay5v.cloudfront.net/1x1.gif"),handler:function(params){return _this3._sendByTypeAndParams(TagInspector.TagType.MonitorTag,params)}}];new PerformanceObserver((function(list,obj){for(var entries=list.getEntries(),_loop=function(i){var url=entries[i].name,handler=(handlers.find((function(_ref2){return _ref2.matcher.test(url)}))||{}).handler;handler&&handler(_this3._extractParams(url),url)},i=0;i<entries.length;i++)_loop(i)})).observe({entryTypes:["resource"]})}},{key:"_extractParams",value:function(url){var params=new URLSearchParams(new URL(url).search);return Object.fromEntries(params.entries())}},{key:"_extractConversionHash",value:function(url){var startOfQuery=url.indexOf("?");startOfQuery<0&&(startOfQuery=url.length);var parts=url.substring(0,startOfQuery).split("/");return parts[parts.length-1]}},{key:"_createMessageBridge",value:function(onReady){var _this4=this;if(window.opener)this.targetWin=window.opener,onReady();else{var session=window.sessionStorage.getItem(TagInspector.SessionKey);this.ifr=document.createElement("IFRAME"),this.ifr.style.display="none",this.ifr.src="https://studio.innovid.com/site-tag-inspector/bridge.html"+"?".concat(TagInspector.SessionKey,"=").concat(session),this.ifr.onload=function(){_this4.targetWin=_this4.ifr.contentWindow,onReady()},document.body.appendChild(this.ifr)}}},{key:"_sendByTypeAndParams",value:function(type,params){var message={messageId:"innovid-broadcast",type:type,session:window.sessionStorage.getItem(TagInspector.SessionKey),website:location.href,origin:location.origin,timestamp:Date.now(),params:params};this._sendMessage(message)}},{key:"_sendMessage",value:function(message){this.targetWin?(console.log("INV inspector>> sending a message:",message),this.targetWin.postMessage(message,"*")):(console.log("INV inspector>> buffer a message:",message),this.bufferQueue.push(message))}}])&&TagInspector_defineProperties(Constructor.prototype,protoProps),staticProps&&TagInspector_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),TagInspector}();function _slicedToArray(arr,i){return function(arr){if(Array.isArray(arr))return arr}(arr)||function(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(arr,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function ContextBuilder_ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function ContextBuilder_objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ContextBuilder_ownKeys(Object(source),!0).forEach((function(key){ContextBuilder_defineProperty(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ContextBuilder_ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}function ContextBuilder_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function ContextBuilder_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var ContextBuilder=function(){function ContextBuilder(logger,probId){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,ContextBuilder),this.logger=logger,this.probId=probId}var Constructor,protoProps,staticProps;return Constructor=ContextBuilder,(protoProps=[{key:"build",value:function(domEvent){var _domEvent$target,_domEvent$target2,_this=this,locationContext={host:window.location.hostname,path:window.location.pathname,qs:window.location.search,url:window.location.href},clickContext={click_id:null==domEvent||null===(_domEvent$target=domEvent.target)||void 0===_domEvent$target?void 0:_domEvent$target.id,click_class:null==domEvent||null===(_domEvent$target2=domEvent.target)||void 0===_domEvent$target2?void 0:_domEvent$target2.className},probIdContext={probId:this.probId},context=ContextBuilder_objectSpread(ContextBuilder_objectSpread(ContextBuilder_objectSpread({},locationContext),clickContext),probIdContext);return window.location.search.slice(1).split("&").map((function(keyValue){var _keyValue$split2=_slicedToArray(keyValue.split("="),2),key=_keyValue$split2[0],value=_keyValue$split2[1];_this.overrideContext(context,key,value)})),window.inv_data.forEach((function(element){Object.keys(element).forEach((function(k){_this.overrideContext(context,k,element[k])}))})),context}},{key:"overrideContext",value:function(context,key,val){context[this.safeDecode(key)]=this.safeDecode(val)}},{key:"safeDecode",value:function(val){try{return decodeURI(val)}catch(e){return this.logger.info({message:"Failed to decode ["+val+"]:"+e.message||0}),this.logger.info({message:"All good. Falling back to original value:"+val}),val}}}])&&ContextBuilder_defineProperties(Constructor.prototype,protoProps),staticProps&&ContextBuilder_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),ContextBuilder}();function _createForOfIteratorHelper(o,allowArrayLike){var it="undefined"!=typeof Symbol&&o[Symbol.iterator]||o["@@iterator"];if(!it){if(Array.isArray(o)||(it=function(o,minLen){if(!o)return;if("string"==typeof o)return PixelParamsBuilder_arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return PixelParamsBuilder_arrayLikeToArray(o,minLen)}(o))||allowArrayLike&&o&&"number"==typeof o.length){it&&(o=it);var i=0,F=function(){};return{s:F,n:function(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}},e:function(_e){throw _e},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var err,normalCompletion=!0,didErr=!1;return{s:function(){it=it.call(o)},n:function(){var step=it.next();return normalCompletion=step.done,step},e:function(_e2){didErr=!0,err=_e2},f:function(){try{normalCompletion||null==it.return||it.return()}finally{if(didErr)throw err}}}}function PixelParamsBuilder_arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function PixelParamsBuilder_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var PixelParamsBuilder=function(){function PixelParamsBuilder(pixel,context){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,PixelParamsBuilder),this.pixel=JSON.parse(JSON.stringify(pixel)),this.context=context}var Constructor,protoProps,staticProps;return Constructor=PixelParamsBuilder,(protoProps=[{key:"build",value:function(){var _this=this;return this.pixel.qs.map((function(param){"invpid"===param.key&&(_this.context[param.value]=_this.context.probId||"");var foundValues=(Array.isArray(param.value)?param.value:[param.value]).filter((function(val){return _this.context.hasOwnProperty(val)}));return param.value=foundValues.length>=0?foundValues[0]:param.qsMacro,encodeURI(param.key)+"="+encodeURI(_this.findValueInKeys([param.value,param.qsMacro],param.qsMacro))})).join("&")}},{key:"findValueInKeys",value:function(keys,defaultValue){var _step,_iterator=_createForOfIteratorHelper(keys);try{for(_iterator.s();!(_step=_iterator.n()).done;){var key=_step.value;if(this.hasKey(key))return this.context[key]}}catch(err){_iterator.e(err)}finally{_iterator.f()}return defaultValue}},{key:"hasKey",value:function(key){return this.context.hasOwnProperty(key)}}])&&PixelParamsBuilder_defineProperties(Constructor.prototype,protoProps),staticProps&&PixelParamsBuilder_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),PixelParamsBuilder}();function EventHandler_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var EventHandler=function(){function EventHandler(htmlEmbedder,logger,pixelReporter,monitor){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,EventHandler),this.htmlEmbedder=htmlEmbedder,this.logger=logger,this.pixelReporter=pixelReporter,this.monitor=monitor}var Constructor,protoProps,staticProps;return Constructor=EventHandler,protoProps=[{key:"handle",value:function(event){var _this=this,probId=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return function(){var domEvent=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;try{var context=new ContextBuilder(_this.logger,probId).build(domEvent),matchedActions=event.actions.filter((function(action){return action.matchers.every((function(m){return new RegExp(m.regexPattern).test(context[m.matcherType.toLowerCase()])}))})),pixelsToReport=matchedActions.reduce((function(pixels,action){var urls=action.tags.map((function(tag){var params=new PixelParamsBuilder(tag,context).build();return"".concat(tag.base).concat(params.length>0?"?".concat(params):"")}));return pixels.concat(urls)}),[]);pixelsToReport.forEach((function(pixel){_this.pixelReporter.reportWithCacheBuster(pixel,(function(){_this.monitor.error({message:"Failed to fire pixel",cause:pixel})}))}));var htmlElementsToEmbed=matchedActions.reduce((function(elements,action){var htmls=action.htmlElements.map((function(html){return html.content}));return elements.concat(htmls)}),[]);htmlElementsToEmbed.forEach((function(html){_this.htmlEmbedder.embed(html,(function(){_this.monitor.error({message:"Failed to embed HTML script",cause:html})}))})),0===pixelsToReport.length||htmlElementsToEmbed.length}catch(e){_this.logger.error({name:e.name,message:e.message,details:"failed during runtime on event: ".concat(event.eventType)}),_this.monitor.error({name:e.name,message:e.message,cause:"".concat(event.eventType,"-event")})}}}}],protoProps&&EventHandler_defineProperties(Constructor.prototype,protoProps),staticProps&&EventHandler_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),EventHandler}();function HtmlElementsEmbedder_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var HtmlElementsEmbedder=function(){function HtmlElementsEmbedder(){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,HtmlElementsEmbedder)}var Constructor,protoProps,staticProps;return Constructor=HtmlElementsEmbedder,protoProps=[{key:"embed",value:function(htmlContent){var onError=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},script=document.createElement("SCRIPT");script.onerror=onError(htmlContent),script.type="application/javascript",script.async=!0,script.innerHTML=htmlContent,document.head.appendChild(script)}}],protoProps&&HtmlElementsEmbedder_defineProperties(Constructor.prototype,protoProps),staticProps&&HtmlElementsEmbedder_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),HtmlElementsEmbedder}();function TopicsObserver_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var TopicsObserver=function(){function TopicsObserver(){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,TopicsObserver)}var Constructor,protoProps,staticProps;return Constructor=TopicsObserver,(protoProps=[{key:"safeObserve",value:function(config){try{if(![1560].some((function(advId){return config.metadata.advertiserId===advId})))return;var ifr=document.createElement("IFRAME");ifr.src="https://rtr.innovid.com/observe-topics.html",ifr.setAttribute("style","width: 0px; height: 0px; display: none; position: absolute; top: -1000px; left: -1000px;"),ifr.setAttribute("frameborder","0"),ifr.setAttribute("width","0"),ifr.setAttribute("height","0"),ifr.setAttribute("marginwidth","0"),ifr.setAttribute("marginheight","0"),ifr.setAttribute("bordercolor","#000000"),ifr.setAttribute("scrolling","no"),ifr.setAttribute("browsingtopics",""),document.body&&document.body.appendChild(ifr)}catch(e){}}}])&&TopicsObserver_defineProperties(Constructor.prototype,protoProps),staticProps&&TopicsObserver_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),TopicsObserver}();function ProbIdGenerator_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var ProbIdGenerator=function(){function ProbIdGenerator(){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,ProbIdGenerator)}var Constructor,protoProps,staticProps;return Constructor=ProbIdGenerator,(protoProps=[{key:"getProbId",value:function(_ref){var onProbIdReceived=_ref.onProbIdReceived,onProbIdError=_ref.onProbIdError,script=document.createElement("SCRIPT");script.type="text/javascript",script.src="https://s-static.innovid.com/innovid-prob-id/latest/IVPID.min.js ",script.onload=function(){var innovidProbId=window.IVPID;innovidProbId?innovidProbId.getInnovidProbId((function(theID,err){err?onProbIdError(err):onProbIdReceived(theID)})):onProbIdError(Error("missing IVPID"))},(document.body||document.head).appendChild(script)}}])&&ProbIdGenerator_defineProperties(Constructor.prototype,protoProps),staticProps&&ProbIdGenerator_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),ProbIdGenerator}();!function(){var config={events:[{eventType:"load",actions:[{matchers:[{matcherType:"url",regexPattern:"https://www\\.marriott\\.com/search/findHotels\\.mi"}],tags:[{base:"https://ag.innovid.com/retargeting/pixel",qs:[{key:"ownerId",value:"519",qsMacro:"519"},{key:"eventId",value:"hotelsearch",qsMacro:"hotel-search"},{key:"BrandCode",value:"dataLayerpropbrandcode",qsMacro:"%dataLayer.prop_brand_code%"},{key:"MarshaCode",value:"dataLayerpropmarshacode",qsMacro:"%dataLayer.prop_marsha_code%"}]}],htmlElements:[]},{matchers:[{matcherType:"url",regexPattern:"https://element-hotels\\.marriott\\.com/"}],tags:[{base:"https://ag.innovid.com/retargeting/pixel",qs:[{key:"ownerId",value:"519",qsMacro:"519"},{key:"eventId",value:"elementbrand",qsMacro:"element-brand"},{key:"BrandCode",value:"dataLayerpropbrandcode",qsMacro:"%dataLayer.prop_brand_code%"},{key:"MarshaCode",value:"dataLayerpropmarshacode",qsMacro:"%dataLayer.prop_marsha_code%"}]}],htmlElements:[]},{matchers:[{matcherType:"url",regexPattern:"https://courtyard\\.marriott\\.com/"}],tags:[{base:"https://ag.innovid.com/retargeting/pixel",qs:[{key:"ownerId",value:"519",qsMacro:"519"},{key:"eventId",value:"courtyardbrand",qsMacro:"courtyard-brand"},{key:"BrandCode",value:"dataLayerpropbrandcode",qsMacro:"%dataLayer.prop_brand_code%"},{key:"MarshaCode",value:"dataLayerpropmarshacode",qsMacro:"%dataLayer.prop_marsha_code%"}]}],htmlElements:[]},{matchers:[{matcherType:"url",regexPattern:"https://www\\.marriott\\.com/en-us/hotels/wasba-ac-hotel-bethesda-downtown/overview"}],tags:[{base:"https://ag.innovid.com/retargeting/pixel",qs:[{key:"ownerId",value:"519",qsMacro:"519"},{key:"eventId",value:"achotelbethesdadowntown",qsMacro:"ac-hotel-bethesda-downtown"},{key:"BrandCode",value:"dataLayerpropbrandcode",qsMacro:"%dataLayer.prop_brand_code%"},{key:"MarshaCode",value:"dataLayerpropmarshacode",qsMacro:"%dataLayer.prop_marsha_code%"}]}],htmlElements:[]},{matchers:[{matcherType:"url",regexPattern:"https://st-regis\\.marriott\\.com/"}],tags:[{base:"https://ag.innovid.com/retargeting/pixel",qs:[{key:"ownerId",value:"519",qsMacro:"519"},{key:"eventId",value:"stregisbrand",qsMacro:"stregis-brand"},{key:"BrandCode",value:"dataLayerpropbrandcode",qsMacro:"%dataLayer.prop_brand_code%"},{key:"MarshaCode",value:"dataLayerpropmarshacode",qsMacro:"%dataLayer.prop_marsha_code%"}]}],htmlElements:[]},{matchers:[{matcherType:"url",regexPattern:"https://protea\\.marriott\\.com/"}],tags:[{base:"https://ag.innovid.com/retargeting/pixel",qs:[{key:"ownerId",value:"519",qsMacro:"519"},{key:"eventId",value:"proteabrand",qsMacro:"protea-brand"},{key:"BrandCode",value:"dataLayerpropbrandcode",qsMacro:"%dataLayer.prop_brand_code%"},{key:"MarshaCode",value:"dataLayerpropmarshacode",qsMacro:"%dataLayer.prop_marsha_code%"}]}],htmlElements:[]},{matchers:[{matcherType:"url",regexPattern:"https://le-meridien\\.marriott\\.com/"}],tags:[{base:"https://ag.innovid.com/retargeting/pixel",qs:[{key:"ownerId",value:"519",qsMacro:"519"},{key:"eventId",value:"lemeridienbrand",qsMacro:"lemeridien-brand"},{key:"BrandCode",value:"dataLayerpropbrandcode",qsMacro:"%dataLayer.prop_brand_code%"},{key:"MarshaCode",value:"dataLayerpropmarshacode",qsMacro:"%dataLayer.prop_marsha_code%"}]}],htmlElements:[]},{matchers:[{matcherType:"url",regexPattern:"https://moxy-hotels\\.marriott\\.com/"}],tags:[{base:"https://ag.innovid.com/retargeting/pixel",qs:[{key:"ownerId",value:"519",qsMacro:"519"},{key:"eventId",value:"moxyhotelsbrand",qsMacro:"moxyhotels-brand"},{key:"BrandCode",value:"dataLayerpropbrandcode",qsMacro:"%dataLayer.prop_brand_code%"},{key:"MarshaCode",value:"dataLayerpropmarshacode",qsMacro:"%dataLayer.prop_marsha_code%"}]}],htmlElements:[]},{matchers:[{matcherType:"url",regexPattern:"https://marriott-hotels\\.marriott\\.com/"}],tags:[{base:"https://ag.innovid.com/retargeting/pixel",qs:[{key:"ownerId",value:"519",qsMacro:"519"},{key:"eventId",value:"marriotthotelsbrand",qsMacro:"marriotthotels-brand"},{key:"BrandCode",value:"dataLayerpropbrandcode",qsMacro:"%dataLayer.prop_brand_code%"},{key:"MarshaCode",value:"dataLayerpropmarshacode",qsMacro:"%dataLayer.prop_marsha_code%"}]}],htmlElements:[]},{matchers:[{matcherType:"url",regexPattern:"https://renaissance-hotels\\.marriott\\.com/"}],tags:[{base:"https://ag.innovid.com/retargeting/pixel",qs:[{key:"ownerId",value:"519",qsMacro:"519"},{key:"eventId",value:"renaissancebrand",qsMacro:"renaissance-brand"},{key:"BrandCode",value:"dataLayerpropbrandcode",qsMacro:"%dataLayer.prop_brand_code%"},{key:"MarshaCode",value:"dataLayerpropmarshacode",qsMacro:"%dataLayer.prop_marsha_code%"}]}],htmlElements:[]},{matchers:[{matcherType:"url",regexPattern:"https://www\\.marriott\\.com/reservation/confirmation\\.mi"}],tags:[{base:"https://ag.innovid.com/retargeting/pixel",qs:[{key:"ownerId",value:"519",qsMacro:"519"},{key:"eventId",value:"confirmationpage",qsMacro:"confirmation-page"},{key:"BrandCode",value:"dataLayerpropbrandcode",qsMacro:"%dataLayer.prop_brand_code%"},{key:"MarshaCode",value:"dataLayerpropmarshacode",qsMacro:"%dataLayer.prop_marsha_code%"}]}],htmlElements:[]},{matchers:[{matcherType:"url",regexPattern:"https://the-luxury-collection\\.marriott\\.com/"}],tags:[{base:"https://ag.innovid.com/retargeting/pixel",qs:[{key:"ownerId",value:"519",qsMacro:"519"},{key:"eventId",value:"luxurycollectionbrand",qsMacro:"luxurycollection-brand"},{key:"BrandCode",value:"dataLayerpropbrandcode",qsMacro:"%dataLayer.prop_brand_code%"},{key:"MarshaCode",value:"dataLayerpropmarshacode",qsMacro:"%dataLayer.prop_marsha_code%"}]}],htmlElements:[]},{matchers:[{matcherType:"url",regexPattern:"https://fairfield\\.marriott\\.com/"}],tags:[{base:"https://ag.innovid.com/retargeting/pixel",qs:[{key:"ownerId",value:"519",qsMacro:"519"},{key:"eventId",value:"fairfieldbrand",qsMacro:"fairfield-brand"},{key:"BrandCode",value:"dataLayerpropbrandcode",qsMacro:"%dataLayer.prop_brand_code%"},{key:"MarshaCode",value:"dataLayerpropmarshacode",qsMacro:"%dataLayer.prop_marsha_code%"}]}],htmlElements:[]},{matchers:[{matcherType:"url",regexPattern:"https://www\\.marriott\\.com/default\\.mi"}],tags:[{base:"https://ag.innovid.com/retargeting/pixel",qs:[{key:"ownerId",value:"519",qsMacro:"519"},{key:"eventId",value:"homepage",qsMacro:"home-page"},{key:"BrandCode",value:"dataLayerpropbrandcode",qsMacro:"%dataLayer.prop_brand_code%"},{key:"MarshaCode",value:"dataLayerpropmarshacode",qsMacro:"%dataLayer.prop_marsha_code%"}]}],htmlElements:[]},{matchers:[{matcherType:"url",regexPattern:"https://homes-and-villas\\.marriott\\.com/"}],tags:[{base:"https://ag.innovid.com/retargeting/pixel",qs:[{key:"ownerId",value:"519",qsMacro:"519"},{key:"eventId",value:"homesandvillasbrand",qsMacro:"homesandvillas-brand"},{key:"BrandCode",value:"dataLayerpropbrandcode",qsMacro:"%dataLayer.prop_brand_code%"},{key:"MarshaCode",value:"dataLayerpropmarshacode",qsMacro:"%dataLayer.prop_marsha_code%"}]}],htmlElements:[]},{matchers:[{matcherType:"url",regexPattern:"https://sheraton\\.marriott\\.com/"}],tags:[{base:"https://ag.innovid.com/retargeting/pixel",qs:[{key:"ownerId",value:"519",qsMacro:"519"},{key:"eventId",value:"sheratonbrand",qsMacro:"sheraton-brand"},{key:"BrandCode",value:"dataLayerpropbrandcode",qsMacro:"%dataLayer.prop_brand_code%"},{key:"MarshaCode",value:"dataLayerpropmarshacode",qsMacro:"%dataLayer.prop_marsha_code%"}]}],htmlElements:[]},{matchers:[{matcherType:"url",regexPattern:"https://autograph-hotels\\.marriott\\.com/"}],tags:[{base:"https://ag.innovid.com/retargeting/pixel",qs:[{key:"ownerId",value:"519",qsMacro:"519"},{key:"eventId",value:"autographhotelsbrand",qsMacro:"autographhotels-brand"},{key:"BrandCode",value:"dataLayerpropbrandcode",qsMacro:"%dataLayer.prop_brand_code%"},{key:"MarshaCode",value:"dataLayerpropmarshacode",qsMacro:"%dataLayer.prop_marsha_code%"}]}],htmlElements:[]},{matchers:[{matcherType:"url",regexPattern:"https://aloft-hotels\\.marriott\\.com/"}],tags:[{base:"https://ag.innovid.com/retargeting/pixel",qs:[{key:"ownerId",value:"519",qsMacro:"519"},{key:"eventId",value:"alofthotelsbrand",qsMacro:"alofthotels-brand"},{key:"BrandCode",value:"dataLayerpropbrandcode",qsMacro:"%dataLayer.prop_brand_code%"},{key:"MarshaCode",value:"dataLayerpropmarshacode",qsMacro:"%dataLayer.prop_marsha_code%"}]}],htmlElements:[]},{matchers:[{matcherType:"url",regexPattern:"https://jw-marriott\\.marriott\\.com/"}],tags:[{base:"https://ag.innovid.com/retargeting/pixel",qs:[{key:"ownerId",value:"519",qsMacro:"519"},{key:"eventId",value:"jwmarriottbrand",qsMacro:"jwmarriott-brand"},{key:"BrandCode",value:"dataLayerpropbrandcode",qsMacro:"%dataLayer.prop_brand_code%"},{key:"MarshaCode",value:"dataLayerpropmarshacode",qsMacro:"%dataLayer.prop_marsha_code%"}]}],htmlElements:[]},{matchers:[{matcherType:"url",regexPattern:"https://www\\.ritzcarlton\\.com/"}],tags:[{base:"https://ag.innovid.com/retargeting/pixel",qs:[{key:"ownerId",value:"519",qsMacro:"519"},{key:"eventId",value:"ritzcarltonbrand",qsMacro:"ritzcarlton-brand"},{key:"BrandCode",value:"dataLayerpropbrandcode",qsMacro:"%dataLayer.prop_brand_code%"},{key:"MarshaCode",value:"dataLayerpropmarshacode",qsMacro:"%dataLayer.prop_marsha_code%"}]}],htmlElements:[]},{matchers:[{matcherType:"url",regexPattern:"https://springhillsuites\\.marriott\\.com/"}],tags:[{base:"https://ag.innovid.com/retargeting/pixel",qs:[{key:"ownerId",value:"519",qsMacro:"519"},{key:"eventId",value:"springhillsuitesbrand",qsMacro:"springhillsuites-brand"},{key:"BrandCode",value:"dataLayerpropbrandcode",qsMacro:"%dataLayer.prop_brand_code%"},{key:"MarshaCode",value:"dataLayerpropmarshacode",qsMacro:"%dataLayer.prop_marsha_code%"}]}],htmlElements:[]},{matchers:[{matcherType:"url",regexPattern:"https://delta-hotels\\.marriott\\.com/"}],tags:[{base:"https://ag.innovid.com/retargeting/pixel",qs:[{key:"ownerId",value:"519",qsMacro:"519"},{key:"eventId",value:"deltahotelsbrand",qsMacro:"deltahotels-brand"},{key:"BrandCode",value:"dataLayerpropbrandcode",qsMacro:"%dataLayer.prop_brand_code%"},{key:"MarshaCode",value:"dataLayerpropmarshacode",qsMacro:"%dataLayer.prop_marsha_code%"}]}],htmlElements:[]},{matchers:[{matcherType:"url",regexPattern:"https://tribute-portfolio\\.marriott\\.com/"}],tags:[{base:"https://ag.innovid.com/retargeting/pixel",qs:[{key:"ownerId",value:"519",qsMacro:"519"},{key:"eventId",value:"tributehotelsbrand",qsMacro:"tributehotels-brand"},{key:"BrandCode",value:"dataLayerpropbrandcode",qsMacro:"%dataLayer.prop_brand_code%"},{key:"MarshaCode",value:"dataLayerpropmarshacode",qsMacro:"%dataLayer.prop_marsha_code%"}]}],htmlElements:[]},{matchers:[{matcherType:"url",regexPattern:"https://residence-inn\\.marriott\\.com/"}],tags:[{base:"https://ag.innovid.com/retargeting/pixel",qs:[{key:"ownerId",value:"519",qsMacro:"519"},{key:"eventId",value:"residenceinnbrand",qsMacro:"residenceinn-brand"},{key:"BrandCode",value:"dataLayerpropbrandcode",qsMacro:"%dataLayer.prop_brand_code%"},{key:"MarshaCode",value:"dataLayerpropmarshacode",qsMacro:"%dataLayer.prop_marsha_code%"}]}],htmlElements:[]},{matchers:[{matcherType:"url",regexPattern:"https://www\\.marriott\\.com/reservation/rateListMenu\\.mi"}],tags:[{base:"https://ag.innovid.com/retargeting/pixel",qs:[{key:"ownerId",value:"519",qsMacro:"519"},{key:"eventId",value:"propertyoverview",qsMacro:"property-overview"},{key:"BrandCode",value:"dataLayerpropbrandcode",qsMacro:"%dataLayer.prop_brand_code%"},{key:"MarshaCode",value:"dataLayerpropmarshacode",qsMacro:"%dataLayer.prop_marsha_code%"}]}],htmlElements:[]},{matchers:[{matcherType:"url",regexPattern:"https://four-points\\.marriott\\.com/"}],tags:[{base:"https://ag.innovid.com/retargeting/pixel",qs:[{key:"ownerId",value:"519",qsMacro:"519"},{key:"eventId",value:"fourpointsbrand",qsMacro:"fourpoints-brand"},{key:"BrandCode",value:"dataLayerpropbrandcode",qsMacro:"%dataLayer.prop_brand_code%"},{key:"MarshaCode",value:"dataLayerpropmarshacode",qsMacro:"%dataLayer.prop_marsha_code%"}]}],htmlElements:[]},{matchers:[{matcherType:"url",regexPattern:"https://www\\.editionhotels\\.com/"}],tags:[{base:"https://ag.innovid.com/retargeting/pixel",qs:[{key:"ownerId",value:"519",qsMacro:"519"},{key:"eventId",value:"editionbrand",qsMacro:"edition-brand"},{key:"BrandCode",value:"dataLayerpropbrandcode",qsMacro:"%dataLayer.prop_brand_code%"},{key:"MarshaCode",value:"dataLayerpropmarshacode",qsMacro:"%dataLayer.prop_marsha_code%"}]}],htmlElements:[]},{matchers:[{matcherType:"url",regexPattern:"https://www\\.gaylordhotels\\.com"}],tags:[{base:"https://ag.innovid.com/retargeting/pixel",qs:[{key:"ownerId",value:"519",qsMacro:"519"},{key:"eventId",value:"gaylordshotelsbrand",qsMacro:"gaylordshotels-brand"},{key:"BrandCode",value:"dataLayerpropbrandcode",qsMacro:"%dataLayer.prop_brand_code%"},{key:"MarshaCode",value:"dataLayerpropmarshacode",qsMacro:"%dataLayer.prop_marsha_code%"}]}],htmlElements:[]},{matchers:[{matcherType:"url",regexPattern:"https://w-hotels\\.marriott\\.com/"}],tags:[{base:"https://ag.innovid.com/retargeting/pixel",qs:[{key:"ownerId",value:"519",qsMacro:"519"},{key:"eventId",value:"whotelsbrand",qsMacro:"whotels-brand"},{key:"BrandCode",value:"dataLayerpropbrandcode",qsMacro:"%dataLayer.prop_brand_code%"},{key:"MarshaCode",value:"dataLayerpropmarshacode",qsMacro:"%dataLayer.prop_marsha_code%"}]}],htmlElements:[]},{matchers:[{matcherType:"url",regexPattern:"https://design-hotels\\.marriott\\.com/"}],tags:[{base:"https://ag.innovid.com/retargeting/pixel",qs:[{key:"ownerId",value:"519",qsMacro:"519"},{key:"eventId",value:"designhotelsbrand",qsMacro:"designhotels-brand"},{key:"BrandCode",value:"dataLayerpropbrandcode",qsMacro:"%dataLayer.prop_brand_code%"},{key:"MarshaCode",value:"dataLayerpropmarshacode",qsMacro:"%dataLayer.prop_marsha_code%"}]}],htmlElements:[]},{matchers:[{matcherType:"url",regexPattern:"https://www\\.marriott\\.com/reservation/reviewguestinformation\\.mi"}],tags:[{base:"https://ag.innovid.com/retargeting/pixel",qs:[{key:"ownerId",value:"519",qsMacro:"519"},{key:"eventId",value:"abandoncartmember",qsMacro:"abandon-cart-member"},{key:"BrandCode",value:"dataLayerpropbrandcode",qsMacro:"%dataLayer.prop_brand_code%"},{key:"MarshaCode",value:"dataLayerpropmarshacode",qsMacro:"%dataLayer.prop_marsha_code%"}]}],htmlElements:[]},{matchers:[{matcherType:"url",regexPattern:"^https://www\\.marriott\\.com/reservation/guestInfo\\.mi$"}],tags:[{base:"https://ag.innovid.com/retargeting/pixel",qs:[{key:"ownerId",value:"519",qsMacro:"519"},{key:"eventId",value:"abandoncart",qsMacro:"abandon-cart"},{key:"BrandCode",value:"dataLayerpropbrandcode",qsMacro:"%dataLayer.prop_brand_code%"},{key:"MarshaCode",value:"dataLayerpropmarshacode",qsMacro:"%dataLayer.prop_marsha_code%"}]}],htmlElements:[]},{matchers:[{matcherType:"url",regexPattern:"https://towneplacesuites\\.marriott\\.com/"}],tags:[{base:"https://ag.innovid.com/retargeting/pixel",qs:[{key:"ownerId",value:"519",qsMacro:"519"},{key:"eventId",value:"towneplacesuitesbrand",qsMacro:"towneplacesuites-brand"},{key:"BrandCode",value:"dataLayerpropbrandcode",qsMacro:"%dataLayer.prop_brand_code%"},{key:"MarshaCode",value:"dataLayerpropmarshacode",qsMacro:"%dataLayer.prop_marsha_code%"}]}],htmlElements:[]},{matchers:[{matcherType:"url",regexPattern:"https://ac-hotels\\.marriott\\.com/"}],tags:[{base:"https://ag.innovid.com/retargeting/pixel",qs:[{key:"ownerId",value:"519",qsMacro:"519"},{key:"eventId",value:"achotelsbrand",qsMacro:"achotels-brand"},{key:"BrandCode",value:"dataLayerpropbrandcode",qsMacro:"%dataLayer.prop_brand_code%"},{key:"MarshaCode",value:"dataLayerpropmarshacode",qsMacro:"%dataLayer.prop_marsha_code%"}]}],htmlElements:[]},{matchers:[{matcherType:"url",regexPattern:"https://westin\\.marriott\\.com/"}],tags:[{base:"https://ag.innovid.com/retargeting/pixel",qs:[{key:"ownerId",value:"519",qsMacro:"519"},{key:"eventId",value:"westinbrand",qsMacro:"westin-brand"},{key:"BrandCode",value:"dataLayerpropbrandcode",qsMacro:"%dataLayer.prop_brand_code%"},{key:"MarshaCode",value:"dataLayerpropmarshacode",qsMacro:"%dataLayer.prop_marsha_code%"}]}],htmlElements:[]}]}],metadata:{hash:"5094b25d",id:229,advertiserId:519}},pixelReporter=new PixelReporter,logger=new TagLogger(config),cookieDropper=new CookieDropper(pixelReporter),retargetReporter=new RetargetingReporter(pixelReporter),domDispatcher=new DOMEventSubscriber,tagInspector=new TagInspector(config),monitor=new TagMonitor(config,pixelReporter,tagInspector.isEnabled()),actionDecorator=new CustomActionDecorator(retargetReporter,monitor),htmlEmbedder=new HtmlElementsEmbedder,probIdGenerator=new ProbIdGenerator,eventHandler=new EventHandler(htmlEmbedder,logger,pixelReporter,monitor);(new TopicsObserver).safeObserve(config);try{cookieDropper.dropCookie(),[99999,1560].indexOf(config.metadata.advertiserId)>=0?probIdGenerator.getProbId({onProbIdReceived:function(probId){subscribeHandlers(probId),monitor.track(TagMonitor.ActionType.ProbIdSuccess)},onProbIdError:function(e){subscribeHandlers(),monitor.track(TagMonitor.ActionType.ProbIdFailure,{name:e.name,message:e.message,cause:"prob id error"})}}):config.events.forEach((function(event){domDispatcher.subscribeHandler(event.eventType,eventHandler.handle(event))})),actionDecorator.decorate(window,config),monitor.track(TagMonitor.ActionType.Initialize)}catch(e){onInitFailure(e)}function onInitFailure(e){logger.error({name:e.name,message:e.message,details:"failed to initiate container tag"}),monitor.error({name:e.name,message:e.message,cause:"init"})}function subscribeHandlers(){var probId=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;try{config.events.forEach((function(event){domDispatcher.subscribeHandler(event.eventType,eventHandler.handle(event,probId))}))}catch(e){onInitFailure(e)}}}()}();